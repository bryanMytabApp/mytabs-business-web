version: 0.2
env:
  variables:
    # TODO: Chnage API URL
    API_URL: "https://7gwwat7uwc.execute-api.us-east-1.amazonaws.com/dev/"
phases:
  install:
    runtime-versions:
      nodejs: 18
  pre_build:
    commands:
      # instalar dependencias del client
      - npm install
      - npm install --global --unsafe-perm serverless@3
  build:
    commands:
      # Sustituir endpoint de API Gateway en client
      - sed -i -e 's|"backendUrl":.*|"backendUrl":"https://7gwwat7uwc.execute-api.us-east-1.amazonaws.com/dev/",|g' ./client/src/config.json
      - sed -i -e 's|"bucketUrl":.*|"bucketUrl":\ "https://mytabs-core-dev.s3.amazonaws.com/",|g' ./client/src/config.json
      - sed -i -e 's|"env":.*|"env":\ "dev", |g' ./client/src/config.json
      - sed -i -e "s|NODE_ENV\=.*|NODE_ENV\=dev|g" client/.env
      - sed -i -e "s|REACT_APP_ROOT_API\=.*|REACT_APP_ROOT_API\=$API_URL|g" client/.env
      - npm run build
      - npm run deploy
